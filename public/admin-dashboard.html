<!DOCTYPE html>
<html lang="ar">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>لوحة تحكم الادمن - المراسلات</title>
  <style>
    /* متغيرات الألوان للدارك مود */
    :root {
      --primary: #0d6efd;
      --primary-dark: #0b5ed7;
      --secondary: #6c757d;
      --success: #198754;
      --danger: #dc3545;
      --warning: #ffc107;
      --info: #0dcaf0;
      --dark-bg: #121212;
      --dark-card: #1e1e1e;
      --dark-border: #2d2d2d;
      --dark-text: #f8f9fa;
      --dark-text-secondary: #adb5bd;
      --medical-blue: #1a73e8;
      --medical-green: #2e7d32;
      --medical-red: #c62828;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Cairo", "Segoe UI", "Noto Sans Arabic", sans-serif;
      direction: rtl;
      background-color: var(--dark-bg);
      color: var(--dark-text);
      min-height: 100vh;
      padding: 20px;
      line-height: 1.6;
    }

    /* ترويسة الصفحة */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 25px;
      background: linear-gradient(135deg, var(--medical-blue) 0%, #0d47a1 100%);
      border-radius: 12px;
      color: white;
      box-shadow: 0 4px 20px rgba(13, 110, 253, 0.2);
    }

    .header-content {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo {
      width: 50px;
      height: 50px;
      background: white;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: var(--medical-blue);
      font-weight: bold;
    }

    h1 {
      font-size: 1.8rem;
      font-weight: 700;
      margin: 0;
    }

    .subtitle {
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.9rem;
      margin-top: 5px;
    }

    h2 {
      margin-bottom: 20px;
      color: var(--dark-text);
      padding-bottom: 12px;
      border-bottom: 3px solid var(--medical-blue);
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    h2 i {
      color: var(--medical-blue);
    }

    /* الأزرار */
    button {
      background: linear-gradient(135deg, var(--medical-blue) 0%, var(--primary-dark) 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    button:hover {
      background: linear-gradient(135deg, var(--primary-dark) 0%, #0a58ca 100%);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    #logoutBtn {
      background: linear-gradient(135deg, var(--medical-red) 0%, #b71c1c 100%);
    }

    #logoutBtn:hover {
      background: linear-gradient(135deg, #c62828 0%, #a01212 100%);
      box-shadow: 0 4px 12px rgba(198, 40, 40, 0.3);
    }

    /* حاويات المحتوى */
    .content-section {
      background: var(--dark-card);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 30px;
      border: 1px solid var(--dark-border);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    /* قسم إرسال الرسائل */
    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: var(--dark-text);
      font-weight: 500;
      font-size: 0.95rem;
    }

    .email-options {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .email-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      border: 1px solid var(--dark-border);
      cursor: pointer;
      transition: all 0.2s;
    }

    .email-option:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: var(--medical-blue);
    }

    .email-option.selected {
      background: rgba(26, 115, 232, 0.15);
      border-color: var(--medical-blue);
    }

    .email-option input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .email-input-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .email-input-group input[type="email"] {
      flex: 1;
    }

    .email-label {
      font-weight: 600;
      color: var(--dark-text);
      min-width: 80px;
    }

    .email-input {
      width: 100%;
      padding: 14px;
      background: rgba(255, 255, 255, 0.07);
      border: 1px solid var(--dark-border);
      border-radius: 8px;
      color: var(--dark-text);
      font-size: 1em;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    .email-input:focus {
      outline: none;
      border-color: var(--medical-blue);
      background: rgba(255, 255, 255, 0.1);
    }

    .email-input::placeholder {
      color: var(--dark-text-secondary);
    }

    textarea {
      width: 100%;
      padding: 14px;
      background: rgba(255, 255, 255, 0.07);
      border: 1px solid var(--dark-border);
      border-radius: 8px;
      color: var(--dark-text);
      font-size: 1em;
      font-family: inherit;
      transition: border-color 0.2s;
      min-height: 150px;
      resize: vertical;
      line-height: 1.5;
    }

    textarea:focus {
      outline: none;
      border-color: var(--medical-blue);
      background: rgba(255, 255, 255, 0.1);
    }

    textarea::placeholder {
      color: var(--dark-text-secondary);
    }

    /* أزرار الإجراءات */
    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 25px;
      flex-wrap: wrap;
    }

    .action-btn {
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .send-btn {
      background: linear-gradient(135deg, var(--success) 0%, #146c43 100%);
      color: white;
    }

    .send-btn:hover {
      background: linear-gradient(135deg, #157347 0%, #0f5132 100%);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(25, 135, 84, 0.3);
    }

    .clear-btn {
      background: linear-gradient(135deg, var(--warning) 0%, #ff9800 100%);
      color: #212529;
    }

    .clear-btn:hover {
      background: linear-gradient(135deg, #ffca2c 0%, #ffb300 100%);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
    }

    /* الاستجابات */
    .response {
      margin-top: 15px;
      padding: 14px;
      border-radius: 8px;
      text-align: center;
      font-weight: 500;
      display: none;
    }

    .response.show {
      display: block;
    }

    .success {
      background: rgba(25, 135, 84, 0.15);
      color: var(--success);
      border-right: 4px solid var(--success);
    }

    .error {
      background: rgba(220, 53, 69, 0.15);
      color: var(--danger);
      border-right: 4px solid var(--danger);
    }

    .info {
      background: rgba(13, 202, 240, 0.15);
      color: var(--info);
      border-right: 4px solid var(--info);
    }

    /* إحصائيات */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: var(--dark-card);
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      border: 1px solid var(--dark-border);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }

    .stat-card .number {
      font-size: 2.2rem;
      font-weight: 700;
      color: var(--medical-blue);
      margin-bottom: 5px;
    }

    .stat-card .label {
      color: var(--dark-text-secondary);
      font-size: 0.9rem;
    }

    /* تذييل الصفحة */
    .footer {
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      color: var(--dark-text-secondary);
      font-size: 0.9rem;
      border-top: 1px solid var(--dark-border);
    }

    /* التصميم المتجاوب */
    @media (max-width: 992px) {
      .header {
        flex-direction: column;
        gap: 20px;
        text-align: center;
      }
      
      .stats-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      body {
        padding: 15px;
      }

      .header {
        padding: 20px;
      }

      h1 {
        font-size: 1.5rem;
      }

      h2 {
        font-size: 1.2rem;
      }

      .email-options {
        grid-template-columns: 1fr;
      }

      .content-section {
        padding: 20px;
      }

      button, .action-btn {
        padding: 10px 20px;
        font-size: 0.9rem;
      }

      .stats-container {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }

      .header {
        padding: 15px;
      }

      h1 {
        font-size: 1.3rem;
      }

      h2 {
        font-size: 1.1rem;
      }

      .content-section {
        padding: 15px;
      }

      .action-buttons {
        flex-direction: column;
      }

      .action-btn {
        width: 100%;
        justify-content: center;
      }
    }

    /* أيقونات */
    .icon {
      font-size: 1.2em;
      vertical-align: middle;
    }
  </style>
  <!-- خط Cairo للعربية -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- أيقونات -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
  <!-- ترويسة الصفحة -->
  <div class="header">
    <div class="header-content">
      <div class="logo">م</div>
      <div>
        <h1>لوحة تحكم الإدمن - المراسلات</h1>
        <div class="subtitle">إرسال رسائل إلى المستلمين المحددين</div>
      </div>
    </div>
    <button id="logoutBtn">
      <i class="fas fa-sign-out-alt"></i>
      تسجيل خروج
    </button>
  </div>

  <!-- إحصائيات -->
  <div class="stats-container">
    <div class="stat-card">
      <div class="number" id="totalRecipients">4</div>
      <div class="label">عدد المستلمين المتاحين</div>
    </div>
    <div class="stat-card">
      <div class="number" id="selectedRecipients">0</div>
      <div class="label">المستلمين المحددين</div>
    </div>
    <div class="stat-card">
      <div class="number" id="totalSent">0</div>
      <div class="label">الرسائل المرسلة</div>
    </div>
    <div class="stat-card">
      <div class="number" id="lastSent">-</div>
      <div class="label">آخر إرسال</div>
    </div>
  </div>

  <!-- قسم إرسال الرسائل -->
  <div class="content-section">
    <h2><i class="fas fa-envelope"></i> إرسال رسالة</h2>
    
    <div class="form-group">
      <label>اختر المستلمين:</label>
      <div class="email-options" id="emailOptions">
        <!-- الخيارات سيتم إنشاؤها بواسطة الجافاسكريبت -->
      </div>
    </div>

    <div class="form-group">
      <label>أو أدخل بريداً إلكترونياً جديداً:</label>
      <div class="email-input-group">
        <input type="email" id="customEmail" class="email-input" placeholder="example@domain.com">
        <button type="button" id="addCustomEmail" class="action-btn" style="background: var(--info);">
          <i class="fas fa-plus"></i>
          إضافة
        </button>
      </div>
    </div>

    <div class="form-group">
      <label for="subjectInput">عنوان الرسالة:</label>
      <input type="text" id="subjectInput" class="email-input" placeholder="أدخل عنوان الرسالة...">
    </div>

    <div class="form-group">
      <label for="messageInput">نص الرسالة:</label>
      <textarea id="messageInput" placeholder="اكتب رسالتك هنا..."></textarea>
    </div>

    <div class="action-buttons">
      <button id="sendMessageBtn" class="action-btn send-btn">
        <i class="fas fa-paper-plane"></i>
        إرسال الرسالة
      </button>
      
      <button id="clearFormBtn" class="action-btn clear-btn">
        <i class="fas fa-eraser"></i>
        مسح النموذج
      </button>
    </div>

    <div id="sendResponse" class="response"></div>
  </div>

  <!-- تذييل الصفحة -->
  <div class="footer">
    <p>© 2024 نظام المراسلات الإلكتروني. جميع الحقوق محفوظة.</p>
    <p>لوحة تحكم الإدمن - الإصدار 1.0</p>
  </div>

  <script>
    // عناصر DOM
    const emailOptionsContainer = document.getElementById('emailOptions');
    const customEmailInput = document.getElementById('customEmail');
    const addCustomEmailBtn = document.getElementById('addCustomEmail');
    const subjectInput = document.getElementById('subjectInput');
    const messageInput = document.getElementById('messageInput');
    const sendMessageBtn = document.getElementById('sendMessageBtn');
    const clearFormBtn = document.getElementById('clearFormBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const sendResponse = document.getElementById('sendResponse');
    
    // عناصر الإحصائيات
    const selectedRecipientsEl = document.getElementById('selectedRecipients');
    const totalSentEl = document.getElementById('totalSent');
    const lastSentEl = document.getElementById('lastSent');

    // قائمة البريدات الإلكترونية الافتراضية (يمكن تعديلها)
    const defaultEmails = [
      { email: "admin@lab.com", label: "المدير العام", checked: false },
      { email: "reception@lab.com", label: "موظف الاستقبال", checked: false },
      { email: "lab.manager@lab.com", label: "مدير المختبر", checked: false },
      { email: "results@lab.com", label: "قسم النتائج", checked: false }
    ];

    // بيانات التطبيق
    let emailList = [...defaultEmails];
    let selectedEmails = [];
    let totalMessagesSent = 0;
    let lastMessageSent = null;

    // تهيئة قائمة البريدات الإلكترونية
    function initEmailOptions() {
      emailOptionsContainer.innerHTML = '';
      
      emailList.forEach((emailObj, index) => {
        const emailOption = document.createElement('div');
        emailOption.className = `email-option ${emailObj.checked ? 'selected' : ''}`;
        emailOption.innerHTML = `
          <input type="checkbox" id="email-${index}" ${emailObj.checked ? 'checked' : ''} data-index="${index}">
          <div>
            <div style="font-weight: 600; color: var(--dark-text);">${emailObj.label}</div>
            <div style="color: var(--dark-text-secondary); font-size: 0.9rem;">${emailObj.email}</div>
          </div>
        `;
        
        // إضافة حدث التحديد
        const checkbox = emailOption.querySelector('input[type="checkbox"]');
        checkbox.addEventListener('change', function() {
          const idx = parseInt(this.getAttribute('data-index'));
          emailList[idx].checked = this.checked;
          emailOption.classList.toggle('selected', this.checked);
          updateSelectedRecipients();
        });
        
        emailOptionsContainer.appendChild(emailOption);
      });
      
      updateSelectedRecipients();
      updateStatistics();
    }

    // تحديث عدد المستلمين المحددين
    function updateSelectedRecipients() {
      selectedEmails = emailList.filter(email => email.checked);
      selectedRecipientsEl.textContent = selectedEmails.length;
    }

    // تحديث الإحصائيات
    function updateStatistics() {
      document.getElementById('totalRecipients').textContent = emailList.length;
      selectedRecipientsEl.textContent = selectedEmails.length;
      totalSentEl.textContent = totalMessagesSent;
      
      if (lastMessageSent) {
        const timeDiff = Math.floor((new Date() - new Date(lastMessageSent)) / 60000); // دقائق
        if (timeDiff < 1) {
          lastSentEl.textContent = 'الآن';
        } else if (timeDiff < 60) {
          lastSentEl.textContent = `منذ ${timeDiff} دقيقة`;
        } else if (timeDiff < 1440) {
          lastSentEl.textContent = `منذ ${Math.floor(timeDiff / 60)} ساعة`;
        } else {
          lastSentEl.textContent = new Date(lastMessageSent).toLocaleDateString('ar-EG');
        }
      } else {
        lastSentEl.textContent = '-';
      }
    }

    // إضافة بريد إلكتروني مخصص
    addCustomEmailBtn.addEventListener('click', function() {
      const email = customEmailInput.value.trim();
      
      if (!email) {
        showResponse('يرجى إدخال بريد إلكتروني', 'error');
        return;
      }
      
      // التحقق من صيغة البريد الإلكتروني
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showResponse('صيغة البريد الإلكتروني غير صحيحة', 'error');
        return;
      }
      
      // التحقق من عدم تكرار البريد الإلكتروني
      if (emailList.some(e => e.email === email)) {
        showResponse('هذا البريد الإلكتروني مضاف بالفعل', 'error');
        return;
      }
      
      // إضافة البريد الإلكتروني الجديد
      emailList.push({
        email: email,
        label: `بريد مخصص ${emailList.length - defaultEmails.length + 1}`,
        checked: true
      });
      
      // إعادة تهيئة القائمة
      initEmailOptions();
      
      // مسح حقل الإدخال
      customEmailInput.value = '';
      
      showResponse(`تم إضافة البريد الإلكتروني: ${email}`, 'success');
    });

    // إرسال الرسالة
    sendMessageBtn.addEventListener('click', function() {
      const subject = subjectInput.value.trim();
      const message = messageInput.value.trim();
      
      // التحقق من البيانات
      if (selectedEmails.length === 0) {
        showResponse('يرجى تحديد مستلم واحد على الأقل', 'error');
        return;
      }
      
      if (!message) {
        showResponse('يرجى كتابة نص الرسالة', 'error');
        return;
      }
      
      // عرض تفاصيل الإرسال للمستخدم
      const emailListText = selectedEmails.map(e => `${e.label} (${e.email})`).join(', ');
      const confirmation = confirm(`هل تريد إرسال الرسالة إلى:
      
المستلمون: ${emailListText}

العنوان: ${subject || 'بدون عنوان'}

الرسالة: ${message.substring(0, 100)}${message.length > 100 ? '...' : ''}

ستتم معالجة الإرسال يدوياً من قبلك.`);
      
      if (!confirmation) return;
      
      // في التطبيق الحقيقي، هنا يتم إرسال طلب إلى الخادم
      // هذا مثال لمحاكاة الإرسال
      
      // محاكاة الإرسال
      sendMessageBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الإرسال...';
      sendMessageBtn.disabled = true;
      
      setTimeout(() => {
        // زيادة عداد الرسائل المرسلة
        totalMessagesSent++;
        lastMessageSent = new Date().toISOString();
        
        // إعادة تعيين النموذج
        subjectInput.value = '';
        messageInput.value = '';
        
        // إلغاء تحديد جميع البريدات
        emailList.forEach(email => email.checked = false);
        initEmailOptions();
        
        // تحديث الإحصائيات
        updateStatistics();
        
        // عرض رسالة النجاح
        showResponse(`تم إعداد الرسالة للإرسال إلى ${selectedEmails.length} مستلم بنجاح. يمكنك الآن إرسالها يدوياً.`, 'success');
        
        // إعادة تعيين زر الإرسال
        sendMessageBtn.innerHTML = '<i class="fas fa-paper-plane"></i> إرسال الرسالة';
        sendMessageBtn.disabled = false;
      }, 1500);
    });

    // مسح النموذج
    clearFormBtn.addEventListener('click', function() {
      if (confirm('هل تريد مسح جميع الحقول؟')) {
        subjectInput.value = '';
        messageInput.value = '';
        customEmailInput.value = '';
        
        // إلغاء تحديد جميع البريدات
        emailList.forEach(email => email.checked = false);
        initEmailOptions();
        
        showResponse('تم مسح النموذج بنجاح', 'info');
      }
    });

    // تسجيل خروج
    logoutBtn.addEventListener('click', function() {
      if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
        // في التطبيق الحقيقي: إرسال طلب تسجيل خروج إلى الخادم
        window.location.href = '/admin-login.html';
      }
    });

    // عرض رسالة الاستجابة
    function showResponse(message, type) {
      sendResponse.textContent = message;
      sendResponse.className = `response ${type} show`;
      
      // إخفاء الرسالة بعد 5 ثواني
      setTimeout(() => {
        sendResponse.classList.remove('show');
      }, 5000);
    }

    // السماح بإدخال الإيميل يدوياً عند الضغط على Enter
    customEmailInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        addCustomEmailBtn.click();
      }
    });

    // تهيئة الصفحة عند التحميل
    document.addEventListener('DOMContentLoaded', function() {
      initEmailOptions();
      
      // تحميل أي بيانات محفوظة
      const savedData = localStorage.getItem('adminDashboardData');
      if (savedData) {
        try {
          const data = JSON.parse(savedData);
          totalMessagesSent = data.totalMessagesSent || 0;
          lastMessageSent = data.lastMessageSent || null;
          
          // تحديث الإحصائيات
          updateStatistics();
        } catch (e) {
          console.log('لا توجد بيانات محفوظة');
        }
      }
      
      // حفظ البيانات عند إغلاق الصفحة
      window.addEventListener('beforeunload', function() {
        const data = {
          totalMessagesSent: totalMessagesSent,
          lastMessageSent: lastMessageSent,
          emailList: emailList
        };
        localStorage.setItem('adminDashboardData', JSON.stringify(data));
      });
    });
  </script>
</body>

</html>
